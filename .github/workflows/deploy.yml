- name: Reemplazo Seguro con Node
        run: |
          node -e "
          const fs = require('fs');
          const fileName = 'index.js';
          let content = fs.readFileSync(fileName, 'utf8');
          
          // Traemos el secreto desde el entorno para que sea texto puro
          const urlHistorial = process.env.URL_HISTORIAL;
          
          if (!urlHistorial) {
            console.error('ERROR: El secreto no llego al script');
            process.exit(1);
          }

          // Reemplazo total usando split/join (el metodo mas seguro para caracteres especiales)
          const newContent = content.split('FLOW_HISTORIAL_REGISTROS').join(urlHistorial);
          
          fs.writeFileSync(fileName, newContent);
          console.log('Reemplazo completado con exito');
          "
        env:
          URL_HISTORIAL: ${{ secrets.FLOW_HISTORIAL_REGISTROS }}
