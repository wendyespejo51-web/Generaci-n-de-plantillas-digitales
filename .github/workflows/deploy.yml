- name: Reemplazo con Diagn√≥stico Forzado
        shell: node {0}
        run: |
          const fs = require('fs');
          const fileName = 'index.js';
          
          if (!fs.existsSync(fileName)) {
            console.log('‚ùå ERROR: No se encuentra index.js en la raiz');
            process.exit(1);
          }

          let content = fs.readFileSync(fileName, 'utf8');
          console.log('Tama√±o del archivo:', content.length, 'caracteres');

          const key = 'FLOW_HISTORIAL_REGISTROS';
          const value = process.env.URL_HISTORIAL;

          if (content.includes(key)) {
            console.log('‚úÖ EXITO: Palabra encontrada. Reemplazando...');
            const cleanUrl = value.replace(/['"`]/g, '');
            // Reemplazo total
            const newContent = content.split(key).join("'" + cleanUrl + "'");
            fs.writeFileSync(fileName, newContent);
            
            // Verificaci√≥n final
            const verify = fs.readFileSync(fileName, 'utf8');
            if (!verify.includes(key)) {
              console.log('üöÄ VERIFICADO: La palabra ya no existe en el archivo.');
            }
          } else {
            console.log('‚ùå ERROR CRITICO: La palabra FLOW_HISTORIAL_REGISTROS no existe en index.js');
            // Imprimimos un pedazo del archivo para ver qu√© hay
            console.log('Muestra del contenido (lineas 5160-5190):');
            console.log(content.substring(content.indexOf('fetch') - 50, content.indexOf('fetch') + 100));
            process.exit(1); // Esto har√° que la Action falle (se ponga roja)
          }
        env:
          URL_HISTORIAL: ${{ secrets.FLOW_HISTORIAL_REGISTROS }}
